<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Utility AI Toolkit ‚Äî AI Mode</title>
  <link rel="preconnect" href="https://cdn.jsdelivr.net" crossorigin>
  <link rel="preconnect" href="https://unpkg.com" crossorigin>
  <script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chrono-node@2.7.5/dist/chrono.min.js"></script>
  <link rel="manifest" href="manifest.webmanifest">
  <meta name="theme-color" content="#0b0f14">
  <link rel="stylesheet" href="styles.css" />
</head>
<body>
  <header>
    <div class="brand">‚öôÔ∏è Utility AI Toolkit ‚Äî <strong>AI Mode</strong></div>
    <div class="inline">
      <span class="pill">Local tools</span>
      <span class="pill">+ Optional ChatGPT via proxy</span>
      <span class="pill">No keys in browser</span>
    </div>
  </header>

  <div class="wrap">
    <div class="tabs">
      <button class="tab-btn active" data-tab="sheets">üìä Spreadsheet Cleaner & Analyzer</button>
      <button class="tab-btn" data-tab="meetings">üìù Meeting Notes ‚Üí Summary & Actions</button>
      <button class="tab-btn" data-tab="settings">üîê AI Settings</button>
      <button class="tab-btn" data-tab="about">‚ÑπÔ∏è About</button>
    </div>

    <!-- SETTINGS TAB -->
    <section id="settings" class="tab card" style="display:none;">
      <h1>üîê AI Settings</h1>
      <p class="muted">To use ChatGPT-quality results, route requests through your own small proxy (Cloudflare Worker or Vercel). This keeps your OpenAI API key off the client.</p>
      <div class="row">
        <div class="card">
          <label>Proxy URL (e.g., https://your-worker.example.workers.dev/chat)</label>
          <input id="proxyUrl" type="text" placeholder="https://your-proxy/chat" />
          <label>Access Token (optional, set in your proxy)</label>
          <input id="proxyToken" type="text" placeholder="token from your proxy (if configured)" />
          <label>Model</label>
          <select id="model">
            <option value="gpt-4o-mini" selected>gpt-4o-mini (fast, cost-effective)</option>
            <option value="gpt-4o">gpt-4o (higher quality)</option>
          </select>
          <div style="margin-top:12px;">
            <button class="btn primary" id="saveAiSettings">Save Settings</button>
            <button class="btn" id="testAi">Test Connection</button>
          </div>
          <p id="aiStatus" class="muted" style="margin-top:10px;"></p>
        </div>
        <div class="card">
          <h2>Setup guide</h2>
          <ol>
            <li>Deploy the included <strong>Cloudflare Worker</strong> or <strong>Vercel function</strong> (files in this ZIP).</li>
            <li>Set environment var <code>OPENAI_API_KEY</code> in the proxy.</li>
            <li>(Optional) Set <code>ACCESS_TOKEN</code> to protect your endpoint.</li>
            <li>Paste the proxy URL/token here and hit <em>Save</em>.</li>
          </ol>
        </div>
      </div>
    </section>

    <!-- SHEETS TAB -->
    <section id="sheets" class="tab card">
      <h1>üìä Spreadsheet Cleaner & Analyzer</h1>
      <p class="muted">Local cleaning + stats. Optional: ask AI for deeper insights.</p>

      <div class="grid">
        <div class="card">
          <label for="fileInput">Upload file (.csv, .xlsx)</label>
          <input id="fileInput" type="file" accept=".csv,.xlsx,.xls" />
          <div class="row" style="margin-top:12px">
            <div>
              <label>Duplicate check on columns (comma-separated)</label>
              <input type="text" id="dedupeCols" placeholder="e.g. email, id (optional)" />
            </div>
            <div>
              <label><input type="checkbox" id="fuzzyToggle" /> Fuzzy de-dupe</label>
              <small class="muted">Jaro‚ÄìWinkler</small>
            </div>
          </div>
          <div style="margin-top:12px">
            <button class="btn primary" id="processBtn">Process</button>
            <button class="btn" id="downloadCleanBtn" disabled>‚¨áÔ∏è Clean CSV</button>
            <button class="btn" id="downloadXLSXBtn" disabled>‚¨áÔ∏è Excel (.xlsx)</button>
            <button class="btn" id="downloadSummaryBtn" disabled>‚¨áÔ∏è Summary</button>
          </div>
          <p id="sheetStatus" class="muted" style="margin-top:10px;"></p>

          <div id="tableWrap" class="card" style="display:none;">
            <h2>Cleaned Preview</h2>
            <div style="max-height:320px; overflow:auto;">
              <table id="previewTable"></table>
            </div>
          </div>
        </div>

        <div class="card">
          <h2>Quick Stats</h2>
          <div class="row">
            <div><span class="muted">Rows:</span> <strong id="statRows">‚Äì</strong></div>
            <div><span class="muted">Columns:</span> <strong id="statCols">‚Äì</strong></div>
          </div>
          <div id="numStats" style="margin-top:10px;"></div>

          <h2 style="margin-top:16px;">AI Insights (optional)</h2>
          <button class="btn" id="askAiInsights">ü§ñ Ask AI for insights</button>
          <div id="aiInsightsBox" class="muted" style="margin-top:10px;">‚Äî</div>

          <h2 style="margin-top:16px;">Chart a numeric column</h2>
          <select id="numericColumnSelect"><option value="">(none)</option></select>
          <canvas id="chartCanvas" style="margin-top:10px;"></canvas>
        </div>
      </div>
    </section>

    <!-- MEETINGS TAB -->
    <section id="meetings" class="tab card" style="display:none;">
      <h1>üìù Meeting Notes ‚Üí Summary & Action Items</h1>
      <p class="muted">Choose local (free) or AI mode (better quality). AI uses your proxy.</p>
      <div class="row">
        <div class="card">
          <label for="notesInput">Paste notes / transcript</label>
          <textarea id="notesInput" placeholder="Paste your meeting notes here..."></textarea>
          <div class="inline" style="margin-top:8px;">
            <label><input type="radio" name="sumMode" value="local" checked /> Local</label>
            <label><input type="radio" name="sumMode" value="ai" /> AI</label>
            <label for="numSentences" style="margin:0;">Summary length</label>
            <select id="numSentences">
              <option value="3">3 sentences</option>
              <option value="5" selected>5 sentences</option>
              <option value="8">8 sentences</option>
            </select>
          </div>
          <div style="margin-top:12px;">
            <button class="btn primary" id="summarizeBtn">Summarize</button>
            <button class="btn" id="downloadMeetingBtn" disabled>‚¨áÔ∏è Download Summary & Actions</button>
          </div>
          <p class="muted" style="margin-top:8px;">AI mode uses your proxy URL/token from Settings.</p>
        </div>
        <div class="card">
          <h2>Summary</h2>
          <div id="summaryBox" class="muted">‚Äî</div>
          <h2 style="margin-top:16px;">Action Items</h2>
          <ol id="actionsList"></ol>
        </div>
      </div>
    </section>

    <!-- ABOUT -->
    <section id="about" class="tab card" style="display:none;">
      <h1>‚ÑπÔ∏è About</h1>
      <p>Local utilities + optional AI via your own secure proxy.</p>
    </section>

    <div class="foot">¬© You ‚Äî build, ship, iterate. ‚ú®</div>
  </div>

  <script src="app.js"></script>
</body>
</html>
